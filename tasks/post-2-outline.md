# ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ #2 ê°œìš”

## ê¸°ë³¸ ì •ë³´

**ì œëª©**: WordPress REST API + Node.jsë¡œ ìë™ ë°œí–‰ ì‹œìŠ¤í…œ êµ¬ì¶•í•˜ê¸°

**Slug**: `wordpress-rest-api-nodejs-automation`

**íƒ€ê²Ÿ ë‹¨ì–´ ìˆ˜**: 2500-3000 ë‹¨ì–´

**ì–¸ì–´**: í•œêµ­ì–´ (ko)

**í¬ìŠ¤íŠ¸ #1ê³¼ì˜ ê´€ê³„**:
- í¬ìŠ¤íŠ¸ #1: Claude APIë¡œ ë¸”ë¡œê·¸ ì´ˆì•ˆ ìƒì„±
- í¬ìŠ¤íŠ¸ #2: ìƒì„±ëœ ì´ˆì•ˆì„ WordPressì— ìë™ ë°œí–‰ (ì—°ê²°í¸)

---

## SEO ì „ëµ

### ë©”ì¸ í‚¤ì›Œë“œ
- WordPress REST API
- Node.js ìë™í™”
- WordPress ìë™ ë°œí–‰
- TypeScript WordPress

### ì„œë¸Œ í‚¤ì›Œë“œ
- WordPress Application Password
- REST API ì¸ì¦
- ë§ˆí¬ë‹¤ìš´ WordPress ë³€í™˜
- í”„ë¡ íŠ¸ë§¤í„° ë©”íƒ€ë°ì´í„°
- ë¯¸ë””ì–´ ìë™ ì—…ë¡œë“œ

### íƒ€ê²Ÿ ë…ì
- Node.js/TypeScript ê°œë°œì
- WordPress ë¸”ë¡œê±°
- ì½˜í…ì¸  ìë™í™”ì— ê´€ì‹¬ ìˆëŠ” ê°œë°œì
- ë§ˆí¬ë‹¤ìš´ ê¸°ë°˜ ì›Œí¬í”Œë¡œìš° ì‚¬ìš©ì

---

## í¬ìŠ¤íŠ¸ êµ¬ì¡° (8ê°œ ì£¼ìš” ì„¹ì…˜)

### 1. ì„œë¡  (300ë‹¨ì–´)
**ëª©ì **: ë¬¸ì œ ì œê¸° ë° ë…ì ê´€ì‹¬ ìœ ë„

**ë‚´ìš©**:
- ë¬¸ì œ ì •ì˜: "AIë¡œ ì´ˆì•ˆ ìƒì„±í–ˆëŠ”ë°, ìˆ˜ë™ìœ¼ë¡œ WordPressì— ë³µë¶™í•˜ë‚˜ìš”?"
- í•´ê²°ì±… ì œì‹œ: WordPress REST API + Node.js ìë™í™”
- í¬ìŠ¤íŠ¸ #1 ì—°ê²°: "ì´ì „ í¬ìŠ¤íŠ¸ì—ì„œ Claude APIë¡œ ì´ˆì•ˆì„ ìƒì„±í–ˆë‹¤ë©´..."
- ì´ ê¸€ì—ì„œ ì–»ì„ ê²ƒ:
  - WordPress REST API ì´í•´
  - Node.jsë¡œ ìë™ ë°œí–‰ ì‹œìŠ¤í…œ êµ¬ì¶•
  - ë§ˆí¬ë‹¤ìš´ â†’ HTML ë³€í™˜ ë° ë©”íƒ€ë°ì´í„° ì²˜ë¦¬
  - ì´ë¯¸ì§€ ìë™ ì—…ë¡œë“œ

**í›„í‚¹ ìš”ì†Œ**:
- í†µê³„: "ìˆ˜ë™ ë°œí–‰ ì‹œê°„ 15ë¶„ â†’ ìë™í™”ë¡œ 1ë¶„"
- ì‹¤ì œ ë™ì‘í•˜ëŠ” ì½”ë“œ ì œê³µ

### 2. WordPress REST API ì´í•´í•˜ê¸° (400ë‹¨ì–´)
**ëª©ì **: WordPress REST APIì˜ ê¸°ë³¸ ê°œë… ì„¤ëª…

**ë‚´ìš©**:

#### 2.1 WordPress REST APIë€?
- WordPress 4.7ë¶€í„° ê¸°ë³¸ ë‚´ì¥
- HTTP ìš”ì²­ìœ¼ë¡œ WordPress ë°ì´í„° ì¡°ì‘
- JSON í˜•ì‹ ë°ì´í„° êµí™˜
- í”ŒëŸ¬ê·¸ì¸ ì—†ì´ ì‚¬ìš© ê°€ëŠ¥

#### 2.2 ì™œ REST APIë¥¼ ì‚¬ìš©í•´ì•¼ í• ê¹Œ?
- ì›¹ ì¸í„°í˜ì´ìŠ¤ ì—†ì´ í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ì œì–´
- CI/CD íŒŒì´í”„ë¼ì¸ í†µí•© ê°€ëŠ¥
- ë‹¤ì¤‘ í”Œë«í¼ ë™ì‹œ ë°œí–‰ (WordPress, Ghost ë“±)
- Git ê¸°ë°˜ ì›Œí¬í”Œë¡œìš°ì™€ í†µí•©

#### 2.3 REST API vs XML-RPC vs GraphQL
ë¹„êµí‘œ:
| íŠ¹ì§• | REST API | XML-RPC | GraphQL |
|------|----------|---------|---------|
| ê¸°ë³¸ ë‚´ì¥ | âœ… (4.7+) | âœ… (ë ˆê±°ì‹œ) | âŒ (í”ŒëŸ¬ê·¸ì¸) |
| ë³´ì•ˆ | Application Password | ê¸°ë³¸ ì¸ì¦ | ë³µì¡ |
| í•™ìŠµ ê³¡ì„  | ë‚®ìŒ | ì¤‘ê°„ | ë†’ìŒ |
| ì»¤ë®¤ë‹ˆí‹° ì§€ì› | ë†’ìŒ | ë‚®ìŒ | ì¤‘ê°„ |

**ê¶Œì¥**: REST API (ê³µì‹ ì§€ì›, ë³´ì•ˆ, ê°„ë‹¨í•¨)

#### 2.4 ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸
```
GET    /wp-json/wp/v2/posts          # í¬ìŠ¤íŠ¸ ëª©ë¡
POST   /wp-json/wp/v2/posts          # í¬ìŠ¤íŠ¸ ìƒì„±
GET    /wp-json/wp/v2/posts/{id}     # í¬ìŠ¤íŠ¸ ì¡°íšŒ
PUT    /wp-json/wp/v2/posts/{id}     # í¬ìŠ¤íŠ¸ ìˆ˜ì •
DELETE /wp-json/wp/v2/posts/{id}     # í¬ìŠ¤íŠ¸ ì‚­ì œ
POST   /wp-json/wp/v2/media          # ë¯¸ë””ì–´ ì—…ë¡œë“œ
GET    /wp-json/wp/v2/categories     # ì¹´í…Œê³ ë¦¬ ëª©ë¡
GET    /wp-json/wp/v2/tags           # íƒœê·¸ ëª©ë¡
```

### 3. WordPress ì¸ì¦ ì„¤ì • (500ë‹¨ì–´)
**ëª©ì **: Application Password ì„¤ì • ë° ì¸ì¦ ë°©ë²• ì„¤ëª…

**ë‚´ìš©**:

#### 3.1 ì¸ì¦ ë°©ë²• ë¹„êµ
- **Basic Authentication**: ê°œë°œìš©, í”„ë¡œë•ì…˜ ë¶€ì í•©
- **OAuth 2.0**: ë³µì¡, íƒ€ì‚¬ ì•±ìš©
- **Application Password**: â­ ê¶Œì¥ (WordPress 5.6+)
- **JWT Token**: í”ŒëŸ¬ê·¸ì¸ í•„ìš”

#### 3.2 Application Password ì„¤ì •í•˜ê¸° (ë‹¨ê³„ë³„ ê°€ì´ë“œ)

**Step 1: WordPress ë²„ì „ í™•ì¸**
```bash
# WordPress ëŒ€ì‹œë³´ë“œ â†’ ì—…ë°ì´íŠ¸
# í•„ìš”: WordPress 5.6 ì´ìƒ
```

**Step 2: ì‚¬ìš©ì í”„ë¡œí•„ì—ì„œ ìƒì„±**
1. WordPress ê´€ë¦¬ì ë¡œê·¸ì¸
2. ì‚¬ìš©ì â†’ í”„ë¡œí•„ í¸ì§‘
3. "Application Passwords" ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
4. ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„ ì…ë ¥ (ì˜ˆ: "Blog Automation CLI")
5. "ìƒˆ Application Password ì¶”ê°€" í´ë¦­
6. ìƒì„±ëœ ë¹„ë°€ë²ˆí˜¸ ë³µì‚¬ (ê³µë°± í¬í•¨, í•œ ë²ˆë§Œ í‘œì‹œë¨)

**Step 3: ë¹„ë°€ë²ˆí˜¸ ì•ˆì „í•˜ê²Œ ì €ì¥**
```bash
# .env íŒŒì¼ ìƒì„±
cat > .env << 'EOF'
WORDPRESS_URL=https://your-blog.com
WORDPRESS_USERNAME=your-username
WORDPRESS_APP_PASSWORD=xxxx xxxx xxxx xxxx xxxx xxxx
EOF

# .gitignoreì— ì¶”ê°€
echo ".env" >> .gitignore
```

**Step 4: ì¸ì¦ í…ŒìŠ¤íŠ¸**
```bash
# curlë¡œ í…ŒìŠ¤íŠ¸
curl -X GET \
  --user "username:xxxx xxxx xxxx xxxx xxxx xxxx" \
  https://your-blog.com/wp-json/wp/v2/posts
```

#### 3.3 ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€
- âœ… Application Passwordë¥¼ Gitì— ì»¤ë°‹í•˜ì§€ ì•Šê¸°
- âœ… ê° ì• í”Œë¦¬ì¼€ì´ì…˜ë§ˆë‹¤ ë³„ë„ì˜ ë¹„ë°€ë²ˆí˜¸ ì‚¬ìš©
- âœ… ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë¹„ë°€ë²ˆí˜¸ëŠ” ì¦‰ì‹œ ì·¨ì†Œ
- âœ… HTTPS ì‚¬ìš© í•„ìˆ˜ (í‰ë¬¸ ì „ì†¡ ë°©ì§€)
- âœ… IP ì œí•œ (ê°€ëŠ¥í•œ ê²½ìš°)

#### 3.4 ë¬¸ì œ í•´ê²°
- 403 Forbidden: í”ŒëŸ¬ê·¸ì¸ì´ë‚˜ ë°©í™”ë²½ì´ REST API ì°¨ë‹¨ (Wordfence ë“±)
- 401 Unauthorized: ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜ (ê³µë°± í¬í•¨ í™•ì¸)
- 404 Not Found: WordPress ë²„ì „ì´ 5.6 ë¯¸ë§Œ

### 4. Node.js í”„ë¡œì íŠ¸ ì„¤ì • (400ë‹¨ì–´)
**ëª©ì **: TypeScript í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì •

**ë‚´ìš©**:

#### 4.1 í”„ë¡œì íŠ¸ êµ¬ì¡°
```
wordpress-publisher/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ wordpress.ts       # WordPress í´ë¼ì´ì–¸íŠ¸
â”‚   â”œâ”€â”€ markdown.ts        # ë§ˆí¬ë‹¤ìš´ ë³€í™˜ê¸°
â”‚   â”œâ”€â”€ publish.ts         # ë°œí–‰ ë¡œì§
â”‚   â””â”€â”€ cli.ts             # CLI ì§„ì…ì 
â”œâ”€â”€ .env                   # í™˜ê²½ ë³€ìˆ˜
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

#### 4.2 ì´ˆê¸° ì„¤ì •
```bash
# í”„ë¡œì íŠ¸ ìƒì„±
mkdir wordpress-publisher && cd wordpress-publisher
pnpm init

# ì˜ì¡´ì„± ì„¤ì¹˜
pnpm add axios form-data
pnpm add -D typescript @types/node tsx

# TypeScript ì„¤ì •
npx tsc --init --target ES2020 --module NodeNext --moduleResolution NodeNext
```

#### 4.3 package.json ì„¤ì •
```json
{
  "name": "wordpress-publisher",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "tsx src/cli.ts",
    "build": "tsc",
    "start": "node dist/cli.js"
  },
  "dependencies": {
    "axios": "^1.6.0",
    "form-data": "^4.0.0"
  },
  "devDependencies": {
    "@types/node": "^20.10.0",
    "tsx": "^4.7.0",
    "typescript": "^5.3.0"
  }
}
```

#### 4.4 ì™œ axios? fetch vs axios ë¹„êµ
| íŠ¹ì§• | axios | fetch |
|------|-------|-------|
| ê¸°ë³¸ ì œê³µ | âŒ npm ì„¤ì¹˜ | âœ… Node.js 18+ |
| Basic Auth | âœ… ë‚´ì¥ | âŒ ìˆ˜ë™ ì²˜ë¦¬ |
| FormData | âœ… ê°„í¸ | âš ï¸ ë³µì¡ |
| ì—ëŸ¬ ì²˜ë¦¬ | âœ… 4xx/5xx ìë™ | âŒ ìˆ˜ë™ ì²´í¬ |
| TypeScript | âœ… ìš°ìˆ˜ | âœ… ìš°ìˆ˜ |

**ê¶Œì¥**: axios (í¸ì˜ì„± > ë²ˆë“¤ í¬ê¸°)

### 5. WordPress í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„ (600ë‹¨ì–´)
**ëª©ì **: ì‹¤ì œ ë™ì‘í•˜ëŠ” WordPress API í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ì œê³µ

**ë‚´ìš©**:

#### 5.1 ê¸°ë³¸ í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„
```typescript
// src/wordpress.ts
import axios, { AxiosInstance } from 'axios';
import FormData from 'form-data';
import { createReadStream } from 'fs';

export interface WordPressConfig {
  url: string;           // https://your-blog.com
  username: string;      // WordPress ì‚¬ìš©ìëª…
  appPassword: string;   // Application Password
}

export interface PostData {
  title: string;
  content: string;
  status: 'publish' | 'draft' | 'pending' | 'private';
  categories?: number[];
  tags?: number[];
  excerpt?: string;
  featured_media?: number;
}

export class WordPressClient {
  private api: AxiosInstance;

  constructor(config: WordPressConfig) {
    this.api = axios.create({
      baseURL: `${config.url}/wp-json/wp/v2`,
      auth: {
        username: config.username,
        password: config.appPassword,
      },
      headers: {
        'Content-Type': 'application/json',
      },
    });
  }

  /**
   * í¬ìŠ¤íŠ¸ ìƒì„±
   */
  async createPost(data: PostData): Promise<number> {
    try {
      const response = await this.api.post('/posts', data);
      return response.data.id;
    } catch (error) {
      if (axios.isAxiosError(error)) {
        throw new Error(
          `Failed to create post: ${error.response?.data?.message || error.message}`
        );
      }
      throw error;
    }
  }

  /**
   * í¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
   */
  async updatePost(postId: number, data: Partial<PostData>): Promise<void> {
    try {
      await this.api.put(`/posts/${postId}`, data);
    } catch (error) {
      if (axios.isAxiosError(error)) {
        throw new Error(
          `Failed to update post: ${error.response?.data?.message || error.message}`
        );
      }
      throw error;
    }
  }

  /**
   * ë¯¸ë””ì–´ ì—…ë¡œë“œ
   */
  async uploadMedia(filePath: string, title?: string): Promise<number> {
    try {
      const form = new FormData();
      form.append('file', createReadStream(filePath));
      if (title) {
        form.append('title', title);
      }

      const response = await this.api.post('/media', form, {
        headers: {
          ...form.getHeaders(),
        },
      });

      return response.data.id;
    } catch (error) {
      if (axios.isAxiosError(error)) {
        throw new Error(
          `Failed to upload media: ${error.response?.data?.message || error.message}`
        );
      }
      throw error;
    }
  }

  /**
   * ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ë˜ëŠ” ìƒì„±
   */
  async getOrCreateCategory(name: string): Promise<number> {
    try {
      // ê¸°ì¡´ ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰
      const response = await this.api.get('/categories', {
        params: { search: name },
      });

      if (response.data.length > 0) {
        return response.data[0].id;
      }

      // ì—†ìœ¼ë©´ ìƒì„±
      const createResponse = await this.api.post('/categories', { name });
      return createResponse.data.id;
    } catch (error) {
      if (axios.isAxiosError(error)) {
        throw new Error(
          `Failed to get/create category: ${error.response?.data?.message || error.message}`
        );
      }
      throw error;
    }
  }

  /**
   * íƒœê·¸ ì¡°íšŒ ë˜ëŠ” ìƒì„±
   */
  async getOrCreateTag(name: string): Promise<number> {
    try {
      const response = await this.api.get('/tags', {
        params: { search: name },
      });

      if (response.data.length > 0) {
        return response.data[0].id;
      }

      const createResponse = await this.api.post('/tags', { name });
      return createResponse.data.id;
    } catch (error) {
      if (axios.isAxiosError(error)) {
        throw new Error(
          `Failed to get/create tag: ${error.response?.data?.message || error.message}`
        );
      }
      throw error;
    }
  }
}
```

#### 5.2 ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´
- axios.isAxiosError() íƒ€ì… ê°€ë“œ ì‚¬ìš©
- ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ WordPress ì‘ë‹µì—ì„œ ì¶”ì¶œ
- ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ

#### 5.3 ì‚¬ìš© ì˜ˆì œ
```typescript
// í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
const wp = new WordPressClient({
  url: process.env.WORDPRESS_URL!,
  username: process.env.WORDPRESS_USERNAME!,
  appPassword: process.env.WORDPRESS_APP_PASSWORD!,
});

// í¬ìŠ¤íŠ¸ ë°œí–‰
const postId = await wp.createPost({
  title: 'ë‚´ ì²« ìë™ ë°œí–‰ í¬ìŠ¤íŠ¸',
  content: '<p>Hello World!</p>',
  status: 'publish',
});

console.log(`í¬ìŠ¤íŠ¸ ë°œí–‰ ì™„ë£Œ! ID: ${postId}`);
```

### 6. ë§ˆí¬ë‹¤ìš´ ë³€í™˜ ë° ë©”íƒ€ë°ì´í„° ì²˜ë¦¬ (500ë‹¨ì–´)
**ëª©ì **: ë§ˆí¬ë‹¤ìš´ íŒŒì¼ì„ WordPress í¬ë§·ìœ¼ë¡œ ë³€í™˜

**ë‚´ìš©**:

#### 6.1 ë§ˆí¬ë‹¤ìš´ â†’ HTML ë³€í™˜
```typescript
// src/markdown.ts
import { unified } from 'unified';
import remarkParse from 'remark-parse';
import remarkGfm from 'remark-gfm';
import remarkRehype from 'remark-rehype';
import rehypeStringify from 'rehype-stringify';
import matter from 'gray-matter';
import { readFileSync } from 'fs';

export interface PostMetadata {
  title: string;
  slug?: string;
  excerpt?: string;
  categories?: string[];
  tags?: string[];
  status?: 'publish' | 'draft';
  featured_image?: string;
}

export interface ParsedPost {
  metadata: PostMetadata;
  htmlContent: string;
}

export async function parseMarkdownFile(filePath: string): Promise<ParsedPost> {
  // 1. íŒŒì¼ ì½ê¸°
  const fileContent = readFileSync(filePath, 'utf-8');

  // 2. Frontmatter íŒŒì‹±
  const { data, content } = matter(fileContent);

  // 3. ë§ˆí¬ë‹¤ìš´ â†’ HTML ë³€í™˜
  const result = await unified()
    .use(remarkParse)              // ë§ˆí¬ë‹¤ìš´ íŒŒì‹±
    .use(remarkGfm)                // GitHub Flavored Markdown (í‘œ, ì²´í¬ë°•ìŠ¤ ë“±)
    .use(remarkRehype)             // ë§ˆí¬ë‹¤ìš´ â†’ HTML AST ë³€í™˜
    .use(rehypeStringify)          // HTML ë¬¸ìì—´í™”
    .process(content);

  const htmlContent = String(result);

  return {
    metadata: data as PostMetadata,
    htmlContent,
  };
}
```

**ì„¤ì¹˜ í•„ìš” íŒ¨í‚¤ì§€**:
```bash
pnpm add unified remark-parse remark-gfm remark-rehype rehype-stringify gray-matter
```

#### 6.2 Frontmatter ì˜ˆì œ
```markdown
---
title: "WordPress ìë™ ë°œí–‰ í…ŒìŠ¤íŠ¸"
slug: "wordpress-auto-publish-test"
excerpt: "Node.jsë¡œ WordPressì— ìë™ìœ¼ë¡œ í¬ìŠ¤íŠ¸ë¥¼ ë°œí–‰í•˜ëŠ” ë°©ë²•"
categories:
  - "ê°œë°œ"
  - "ìë™í™”"
tags:
  - "WordPress"
  - "Node.js"
  - "REST API"
status: "draft"
featured_image: "./images/featured.jpg"
---

# ë³¸ë¬¸ ì‹œì‘

ì—¬ê¸°ì— ë§ˆí¬ë‹¤ìš´ ë‚´ìš©...
```

#### 6.3 ë©”íƒ€ë°ì´í„° ê²€ì¦
```typescript
import { z } from 'zod';

const PostMetadataSchema = z.object({
  title: z.string().min(1, 'ì œëª©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤'),
  slug: z.string().optional(),
  excerpt: z.string().optional(),
  categories: z.array(z.string()).optional(),
  tags: z.array(z.string()).optional(),
  status: z.enum(['publish', 'draft', 'pending', 'private']).default('draft'),
  featured_image: z.string().optional(),
});

// ì‚¬ìš©
const validatedMetadata = PostMetadataSchema.parse(data);
```

#### 6.4 ì´ë¯¸ì§€ ê²½ë¡œ ì²˜ë¦¬
```typescript
/**
 * ìƒëŒ€ ê²½ë¡œ ì´ë¯¸ì§€ë¥¼ ì ˆëŒ€ ê²½ë¡œë¡œ ë³€í™˜
 */
function resolveImagePath(markdownFilePath: string, imagePath: string): string {
  if (imagePath.startsWith('http')) {
    return imagePath; // ì´ë¯¸ ì ˆëŒ€ URL
  }

  // ìƒëŒ€ ê²½ë¡œ í•´ê²°
  const markdownDir = path.dirname(markdownFilePath);
  return path.resolve(markdownDir, imagePath);
}
```

### 7. í†µí•©: ì „ì²´ ë°œí–‰ ì›Œí¬í”Œë¡œìš° (400ë‹¨ì–´)
**ëª©ì **: ëª¨ë“  ìš”ì†Œë¥¼ í†µí•©í•œ ì™„ì „í•œ ë°œí–‰ ì‹œìŠ¤í…œ

**ë‚´ìš©**:

#### 7.1 ë°œí–‰ í•¨ìˆ˜ êµ¬í˜„
```typescript
// src/publish.ts
import { WordPressClient } from './wordpress';
import { parseMarkdownFile } from './markdown';
import path from 'path';

export interface PublishOptions {
  markdownFile: string;
  dryRun?: boolean;
}

export async function publishToWordPress(
  client: WordPressClient,
  options: PublishOptions
): Promise<number | null> {
  console.log(`ğŸ“„ ë§ˆí¬ë‹¤ìš´ íŒŒì¼ íŒŒì‹± ì¤‘: ${options.markdownFile}`);

  // 1. ë§ˆí¬ë‹¤ìš´ íŒŒì‹±
  const { metadata, htmlContent } = await parseMarkdownFile(options.markdownFile);

  console.log(`âœ… íŒŒì‹± ì™„ë£Œ`);
  console.log(`   ì œëª©: ${metadata.title}`);
  console.log(`   ìƒíƒœ: ${metadata.status || 'draft'}`);

  // 2. Featured Image ì—…ë¡œë“œ (ìˆìœ¼ë©´)
  let featuredMediaId: number | undefined;
  if (metadata.featured_image) {
    console.log(`ğŸ–¼ï¸  Featured Image ì—…ë¡œë“œ ì¤‘...`);
    const imagePath = path.resolve(
      path.dirname(options.markdownFile),
      metadata.featured_image
    );
    featuredMediaId = await client.uploadMedia(imagePath, metadata.title);
    console.log(`âœ… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ (ID: ${featuredMediaId})`);
  }

  // 3. ì¹´í…Œê³ ë¦¬ ID ë³€í™˜
  const categoryIds: number[] = [];
  if (metadata.categories) {
    console.log(`ğŸ“‚ ì¹´í…Œê³ ë¦¬ ì²˜ë¦¬ ì¤‘...`);
    for (const categoryName of metadata.categories) {
      const id = await client.getOrCreateCategory(categoryName);
      categoryIds.push(id);
    }
    console.log(`âœ… ì¹´í…Œê³ ë¦¬: ${metadata.categories.join(', ')}`);
  }

  // 4. íƒœê·¸ ID ë³€í™˜
  const tagIds: number[] = [];
  if (metadata.tags) {
    console.log(`ğŸ·ï¸  íƒœê·¸ ì²˜ë¦¬ ì¤‘...`);
    for (const tagName of metadata.tags) {
      const id = await client.getOrCreateTag(tagName);
      tagIds.push(id);
    }
    console.log(`âœ… íƒœê·¸: ${metadata.tags.join(', ')}`);
  }

  // 5. Dry-run ëª¨ë“œ ì²´í¬
  if (options.dryRun) {
    console.log(`\nğŸ” [Dry-run ëª¨ë“œ] ì‹¤ì œ ë°œí–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`);
    console.log(`\ní¬ìŠ¤íŠ¸ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°:`);
    console.log(JSON.stringify({
      title: metadata.title,
      status: metadata.status || 'draft',
      categories: categoryIds,
      tags: tagIds,
      featured_media: featuredMediaId,
      content_length: htmlContent.length,
    }, null, 2));
    return null;
  }

  // 6. WordPressì— í¬ìŠ¤íŠ¸ ìƒì„±
  console.log(`\nğŸš€ WordPressì— í¬ìŠ¤íŠ¸ ë°œí–‰ ì¤‘...`);
  const postId = await client.createPost({
    title: metadata.title,
    content: htmlContent,
    status: metadata.status || 'draft',
    categories: categoryIds,
    tags: tagIds,
    excerpt: metadata.excerpt,
    featured_media: featuredMediaId,
  });

  console.log(`\nâœ… ë°œí–‰ ì™„ë£Œ!`);
  console.log(`   í¬ìŠ¤íŠ¸ ID: ${postId}`);
  console.log(`   ìƒíƒœ: ${metadata.status || 'draft'}`);

  return postId;
}
```

#### 7.2 CLI ì§„ì…ì 
```typescript
// src/cli.ts
import { Command } from 'commander';
import { WordPressClient } from './wordpress';
import { publishToWordPress } from './publish';
import dotenv from 'dotenv';

dotenv.config();

const program = new Command();

program
  .name('wp-publish')
  .description('WordPress ìë™ ë°œí–‰ ë„êµ¬')
  .version('1.0.0');

program
  .command('publish')
  .description('ë§ˆí¬ë‹¤ìš´ íŒŒì¼ì„ WordPressì— ë°œí–‰')
  .argument('<file>', 'ë§ˆí¬ë‹¤ìš´ íŒŒì¼ ê²½ë¡œ')
  .option('--dry-run', 'ì‹¤ì œ ë°œí–‰í•˜ì§€ ì•Šê³  ë¯¸ë¦¬ë³´ê¸°ë§Œ')
  .action(async (file: string, options) => {
    try {
      // WordPress í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
      const client = new WordPressClient({
        url: process.env.WORDPRESS_URL!,
        username: process.env.WORDPRESS_USERNAME!,
        appPassword: process.env.WORDPRESS_APP_PASSWORD!,
      });

      // ë°œí–‰
      const postId = await publishToWordPress(client, {
        markdownFile: file,
        dryRun: options.dryRun,
      });

      if (postId) {
        console.log(`\nğŸ‰ ì„±ê³µ! WordPressì—ì„œ í™•ì¸í•˜ì„¸ìš”.`);
      }
    } catch (error) {
      console.error(`\nâŒ ì˜¤ë¥˜ ë°œìƒ:`, error);
      process.exit(1);
    }
  });

program.parse();
```

#### 7.3 ì‹¤í–‰ ì˜ˆì œ
```bash
# ì´ˆì•ˆìœ¼ë¡œ ë°œí–‰
npm run dev publish ./posts/my-post.md

# Dry-runìœ¼ë¡œ ë¯¸ë¦¬ë³´ê¸°
npm run dev publish ./posts/my-post.md --dry-run

# ë¹Œë“œ í›„ ì‹¤í–‰
npm run build
node dist/cli.js publish ./posts/my-post.md
```

### 8. ê³ ê¸‰ í™œìš© ë° ë¬¸ì œ í•´ê²° (400ë‹¨ì–´)
**ëª©ì **: ì‹¤ë¬´ íŒ, ë¬¸ì œ í•´ê²°, í™•ì¥ ê°€ëŠ¥ì„±

**ë‚´ìš©**:

#### 8.1 ì´ë¯¸ì§€ ìë™ ìµœì í™”
```typescript
import sharp from 'sharp';

async function optimizeImage(inputPath: string): Promise<Buffer> {
  return await sharp(inputPath)
    .resize(1200, 630, { fit: 'cover' })  // Featured image í¬ê¸°
    .jpeg({ quality: 85 })                // í’ˆì§ˆ 85%
    .toBuffer();
}
```

#### 8.2 ë°°ì¹˜ ë°œí–‰
```typescript
async function batchPublish(files: string[]) {
  for (const file of files) {
    console.log(`\nì²˜ë¦¬ ì¤‘: ${file}`);
    await publishToWordPress(client, { markdownFile: file });

    // ë ˆì´íŠ¸ ë¦¬ë°‹ ë°©ì§€
    await new Promise(resolve => setTimeout(resolve, 2000));
  }
}
```

#### 8.3 ì—ëŸ¬ ë³µêµ¬
```typescript
async function publishWithRetry(
  client: WordPressClient,
  options: PublishOptions,
  maxRetries = 3
): Promise<number | null> {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await publishToWordPress(client, options);
    } catch (error) {
      console.error(`ì‹œë„ ${i + 1}/${maxRetries} ì‹¤íŒ¨:`, error);
      if (i === maxRetries - 1) throw error;
      await new Promise(resolve => setTimeout(resolve, 5000));
    }
  }
  return null;
}
```

#### 8.4 ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

**ë¬¸ì œ 1: 403 Forbidden**
```
ì›ì¸: REST APIê°€ ì°¨ë‹¨ë¨
í•´ê²°:
1. Settings â†’ Permalinksì—ì„œ "Post name" ì„ íƒ
2. ë³´ì•ˆ í”ŒëŸ¬ê·¸ì¸ (Wordfence ë“±) REST API í—ˆìš© ì„¤ì •
3. .htaccess í™•ì¸
```

**ë¬¸ì œ 2: ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨**
```
ì›ì¸: íŒŒì¼ ê¶Œí•œ ë˜ëŠ” í¬ê¸° ì œí•œ
í•´ê²°:
1. WordPress ì—…ë¡œë“œ ë””ë ‰í† ë¦¬ ê¶Œí•œ í™•ì¸ (wp-content/uploads)
2. php.iniì—ì„œ upload_max_filesize í™•ì¸
3. ì´ë¯¸ì§€ ì‚¬ì „ ì••ì¶• (sharp ì‚¬ìš©)
```

**ë¬¸ì œ 3: HTML ê¹¨ì§**
```
ì›ì¸: íŠ¹ìˆ˜ ë¬¸ì ì¸ì½”ë”© ë¬¸ì œ
í•´ê²°:
1. UTF-8 ì¸ì½”ë”© í™•ì¸
2. HTML ì—”í‹°í‹° ì´ìŠ¤ì¼€ì´í”„
3. WordPressì˜ wpautop í•„í„° ì´í•´ (ìë™ <p> íƒœê·¸)
```

#### 8.5 ë‹¤ìŒ ë‹¨ê³„: í™•ì¥ ì•„ì´ë””ì–´
1. **Git ì—°ë™**: Git hookìœ¼ë¡œ commit ì‹œ ìë™ ë°œí–‰
2. **CI/CD í†µí•©**: GitHub Actionsë¡œ ë°°í¬ ìë™í™”
3. **ë‹¤ì¤‘ ë¸”ë¡œê·¸ ì§€ì›**: ì—¬ëŸ¬ WordPress ì‚¬ì´íŠ¸ ë™ì‹œ ë°œí–‰
4. **í¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸**: ê¸°ì¡´ í¬ìŠ¤íŠ¸ ê°ì§€ ë° ì—…ë°ì´íŠ¸
5. **SEO í”ŒëŸ¬ê·¸ì¸ ì—°ë™**: Yoast SEO, Rank Math API í†µí•©

---

## ê²°ë¡  (200ë‹¨ì–´)
**ëª©ì **: í•µì‹¬ ìš”ì•½ ë° í–‰ë™ ìœ ë„

**ë‚´ìš©**:
- ì£¼ìš” í•™ìŠµ ë‚´ìš© ìš”ì•½:
  1. WordPress REST API ì´í•´
  2. Application Password ì¸ì¦
  3. Node.jsë¡œ ìë™ ë°œí–‰ ì‹œìŠ¤í…œ êµ¬ì¶•
  4. ë§ˆí¬ë‹¤ìš´ â†’ WordPress ë³€í™˜
  5. ì‹¤ë¬´ ë¬¸ì œ í•´ê²°

- ë…ìê°€ ì–»ì€ ê²ƒ:
  - âœ… ì™„ì „íˆ ë™ì‘í•˜ëŠ” ë°œí–‰ ì‹œìŠ¤í…œ
  - âœ… ìˆ˜ë™ ì‘ì—… 90% ê°ì†Œ (15ë¶„ â†’ 1ë¶„)
  - âœ… Git ê¸°ë°˜ ì›Œí¬í”Œë¡œìš° í†µí•©
  - âœ… í™•ì¥ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜

- í–‰ë™ ìœ ë„ (CTA):
  - "ì˜¤ëŠ˜ ë°”ë¡œ ì²« ìë™ ë°œí–‰ì„ ì‹œë„í•´ë³´ì„¸ìš”!"
  - GitHub ì €ì¥ì†Œ ê³µìœ  (ì „ì²´ ì½”ë“œ)
  - ëŒ“ê¸€ë¡œ ì§ˆë¬¸ í™˜ì˜

- ë‹¤ìŒ í¬ìŠ¤íŠ¸ ì˜ˆê³ :
  - "ë§ˆí¬ë‹¤ìš´ ê¸°ë°˜ ë¸”ë¡œê·¸ ì›Œí¬í”Œë¡œìš° ìµœì í™”"
  - "AI ë¸”ë¡œê·¸ ìë™í™”ë¡œ ìˆ˜ìµ ë§Œë“¤ê¸°"

---

## ì¶”ê°€ ë¦¬ì†ŒìŠ¤

**ê³µì‹ ë¬¸ì„œ**:
- [WordPress REST API Handbook](https://developer.wordpress.org/rest-api/)
- [Application Passwords Documentation](https://make.wordpress.org/core/2020/11/05/application-passwords-integration-guide/)

**ì˜ˆì œ ì½”ë“œ**:
- ì´ í”„ë¡œì íŠ¸ì˜ GitHub ì €ì¥ì†Œ (ì „ì²´ ì½”ë“œ ê³µê°œ)

**ê´€ë ¨ ë„êµ¬**:
- [axios](https://axios-http.com/)
- [unified](https://unifiedjs.com/)
- [gray-matter](https://github.com/jonschlinkert/gray-matter)

---

## ë©”íƒ€ ì •ë³´

**ì˜ˆìƒ ì‘ì„± ì‹œê°„**: 2-3ì‹œê°„ (ì½”ë“œ ì‘ì„± + í…ŒìŠ¤íŠ¸ + ê²€ì¦)

**ë‚œì´ë„**: ì¤‘ìƒ (Node.js/TypeScript ì¤‘ê¸‰ ìˆ˜ì¤€ í•„ìš”)

**ì„ ìˆ˜ ì§€ì‹**:
- Node.js ê¸°ë³¸
- TypeScript ê¸°ë³¸
- REST API ê°œë…
- WordPress ì‚¬ìš© ê²½í—˜

**í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] ëª¨ë“  ì½”ë“œ ì˜ˆì œê°€ ì‹¤ì œë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
- [ ] WordPress REST API ì—”ë“œí¬ì¸íŠ¸ ì •í™•ì„± ê²€ì¦
- [ ] Application Password ìƒì„± ë‹¨ê³„ ì •í™•ì„± í™•ì¸
- [ ] ì—ëŸ¬ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸ (403, 401, 404)
- [ ] ì´ë¯¸ì§€ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
- [ ] í•œê¸€ í¬ìŠ¤íŠ¸ ì¸ì½”ë”© í…ŒìŠ¤íŠ¸
