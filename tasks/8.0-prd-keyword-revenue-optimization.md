# Epic 8.0 - 키워드 수익성 분석 시스템 (Keyword Revenue Optimization System)

## 1. Introduction/Overview

### 문제 정의
현재 trending 명령어는 Reddit, Hacker News, Twitter의 소셜 미디어 트렌드만 추적합니다. 하지만 소셜 미디어에서 인기 있는 주제가 반드시 검색량이 높거나 광고 수익성이 좋은 것은 아닙니다. 블로거가 광고 수익을 극대화하려면 다음 정보가 필요합니다:

- **검색량 (Search Volume)**: 실제로 사람들이 검색하는 키워드인가?
- **CPC (Cost Per Click)**: 광고 클릭당 수익이 얼마나 되는가?
- **SEO 난이도**: 상위 노출이 가능한 키워드인가?
- **예상 수익**: 이 키워드로 포스트를 작성하면 얼마나 벌 수 있는가?

### 솔루션
기존 `trending` 명령어를 확장하여 **Google Keyword Planner API**와 통합하고, 키워드의 수익성을 분석하는 시스템을 구축합니다. 사용자는 포스팅 전에 trending 명령어를 실행하여 광고 수익이 높을 것으로 예상되는 키워드와 주제를 추천받을 수 있습니다.

### 목표
포스팅 전 키워드 조사 단계에서 **광고 수익 예측 데이터**를 제공하여, 데이터 기반 주제 선정을 가능하게 합니다.

---

## 2. Goals

### Primary Goals
1. **Google Keyword Planner API 통합**: 검색량, CPC, 경쟁 강도 데이터 수집
2. **trending 명령어 확장**: 기존 소셜 트렌드 + 수익성 데이터 통합
3. **수익성 점수 알고리즘**: CPC, 검색량, SEO 난이도를 고려한 균형 점수 계산
4. **키워드 추천**: 광고 수익 예상치가 높은 키워드 목록 제공
5. **주제 추천**: 키워드 조합으로 구체적인 포스트 주제 제안
6. **수익 예측**: 예상 트래픽 기반 광고 수익 계산

### Secondary Goals
1. **JSON 데이터 저장**: 추천 데이터를 파일로 저장하여 재사용
2. **캐싱 시스템**: API 호출 최소화 및 성능 향상
3. **한국어 지원**: 한글 키워드 검색량 및 CPC 데이터 제공

### Success Criteria
- 사용자가 trending 명령어 실행 시 수익성 데이터를 확인할 수 있음
- 추천된 키워드로 작성한 포스트의 광고 수익이 기존 대비 증가
- 월간 광고 수익 증가율 측정 가능

---

## 3. User Stories

### US-8.1: 키워드 수익성 확인
**As a** 블로거
**I want to** trending 명령어 실행 시 각 키워드의 CPC와 검색량을 확인하고
**So that** 광고 수익이 높을 것으로 예상되는 주제를 선택할 수 있습니다.

**Acceptance Criteria:**
- trending 실행 시 CPC, 검색량, SEO 난이도가 표시됨
- 수익성 점수로 정렬된 키워드 목록 제공
- JSON 형식으로 데이터 저장 가능

### US-8.2: 주제 추천
**As a** 블로거
**I want to** trending 명령어가 키워드 조합으로 구체적인 포스트 주제를 제안하고
**So that** 주제 고민 시간을 줄이고 빠르게 포스트 작성을 시작할 수 있습니다.

**Acceptance Criteria:**
- trending 실행 시 추천 주제 목록 제공
- 주제별로 관련 키워드 조합 표시
- 예상 트래픽 및 광고 수익 정보 포함

### US-8.3: 수익 예측
**As a** 블로거
**I want to** 특정 키워드로 포스트를 작성할 때 예상 광고 수익을 확인하고
**So that** 투자 대비 효과(ROI)를 고려하여 작성 여부를 결정할 수 있습니다.

**Acceptance Criteria:**
- 키워드별 예상 월간 트래픽 계산
- 예상 클릭률(CTR) 및 광고 수익 계산
- 보수적/낙관적 시나리오 모두 제공

### US-8.4: 데이터 재사용
**As a** 블로거
**I want to** trending 결과를 JSON 파일로 저장하고
**So that** 나중에 데이터를 다시 조회하거나 분석에 활용할 수 있습니다.

**Acceptance Criteria:**
- --output 옵션으로 JSON 파일 경로 지정 가능
- JSON 파일에 타임스탬프, 키워드, 수익성 데이터 포함
- 저장된 JSON 파일 재로드 가능

---

## 4. Functional Requirements

### FR-8.1: Google Keyword Planner API 통합
**Priority:** P0 (Critical)

**Requirements:**
1. Google Ads API 클라이언트 구현
2. 개발자 토큰, 클라이언트 ID, 클라이언트 시크릿 환경 변수 설정
3. OAuth 2.0 인증 플로우 구현
4. 키워드 검색량 조회 API 호출
5. CPC 예상치 조회 API 호출
6. 경쟁 강도 데이터 조회 API 호출

**Technical Details:**
- Google Ads API v21 사용
- Node.js용 google-ads-api 라이브러리 활용
- 환경 변수: `GOOGLE_ADS_DEVELOPER_TOKEN`, `GOOGLE_ADS_CLIENT_ID`, `GOOGLE_ADS_CLIENT_SECRET`, `GOOGLE_ADS_REFRESH_TOKEN`

### FR-8.2: trending 명령어 확장
**Priority:** P0 (Critical)

**Requirements:**
1. 기존 trending 명령어에 `--revenue` 옵션 추가
2. `--revenue` 옵션 활성화 시 Google Keyword Planner 데이터 통합
3. 소셜 트렌드 점수 + 수익성 점수 통합 알고리즘
4. 통합 점수로 키워드 정렬

**Command Signature:**
```bash
blog trending --revenue [options]
blog trending --revenue --keywords "WordPress,AI" --limit 20
blog trending --revenue --output keywords.json
```

**Options:**
- `--revenue`: 수익성 분석 활성화
- `--output <file>`: JSON 파일로 저장
- `--format <format>`: 출력 형식 (table|json) (기본값: table)
- 기존 옵션 유지: `--sources`, `--limit`, `--keywords`, `--min-score`, `--language`

### FR-8.3: 수익성 점수 계산 알고리즘
**Priority:** P0 (Critical)

**Requirements:**
1. 균형 점수 공식 구현
2. CPC, 검색량, SEO 난이도 가중치 설정
3. 정규화 알고리즘 (0-100 점수)

**Algorithm:**
```
revenue_score = (
  (cpc_normalized * 0.35) +           # CPC 가중치 35%
  (search_volume_normalized * 0.35) + # 검색량 가중치 35%
  (seo_difficulty_normalized * 0.30)  # SEO 난이도 가중치 30%
) * 100

seo_difficulty_normalized = 1 - (difficulty / 100)  # 난이도가 낮을수록 점수 높음
```

**Normalization:**
- CPC: $0.01 (min) ~ $10.00 (max) → 0.0 ~ 1.0
- Search Volume: 10 (min) ~ 100,000 (max) → 0.0 ~ 1.0 (로그 스케일)
- SEO Difficulty: 0 (easy) ~ 100 (hard) → 1.0 ~ 0.0 (역순)

### FR-8.4: 키워드 추천
**Priority:** P0 (Critical)

**Requirements:**
1. revenue_score 기준 상위 N개 키워드 선택
2. 터미널 출력: 컬러 테이블 (CPC, 검색량, 점수)
3. JSON 출력: 전체 데이터 포함

**Output Format (Terminal):**
```
🎯 수익성 높은 키워드 추천

┌────┬──────────────────┬─────────┬──────────┬──────┬───────┐
│ #  │ 키워드           │ CPC     │ 검색량   │ 난이도│ 점수 │
├────┼──────────────────┼─────────┼──────────┼──────┼───────┤
│ 1  │ WordPress 플러그인│ $2.50  │ 12,000  │ 45   │ 78.5 │
│ 2  │ SEO 최적화       │ $1.80  │ 8,500   │ 30   │ 72.3 │
│ 3  │ 블로그 수익화    │ $3.20  │ 5,000   │ 50   │ 71.8 │
└────┴──────────────────┴─────────┴──────────┴──────┴───────┘

💡 추천 주제:
1. "WordPress 플러그인 추천 TOP 10" (예상 수익: $150-300/월)
2. "블로그 SEO 최적화 완벽 가이드" (예상 수익: $100-200/월)
```

**Output Format (JSON):**
```json
{
  "timestamp": "2025-10-29T10:00:00Z",
  "keywords": [
    {
      "keyword": "WordPress 플러그인",
      "cpc": 2.50,
      "searchVolume": 12000,
      "competition": "medium",
      "competitionScore": 45,
      "revenueScore": 78.5,
      "estimatedMonthlyRevenue": {
        "conservative": 150,
        "optimistic": 300
      }
    }
  ],
  "suggestedTopics": [
    {
      "title": "WordPress 플러그인 추천 TOP 10",
      "keywords": ["WordPress 플러그인", "플러그인 추천", "WordPress"],
      "estimatedRevenue": { "min": 150, "max": 300 }
    }
  ]
}
```

### FR-8.5: 주제 추천
**Priority:** P1 (High)

**Requirements:**
1. 상위 키워드 조합으로 포스트 주제 생성
2. 제목 템플릿 활용 ("TOP 10", "완벽 가이드", "비교 분석" 등)
3. 키워드당 1-2개 주제 제안

**Topic Generation Logic:**
- 단일 키워드: "[키워드] 완벽 가이드", "[키워드] TOP 10"
- 복수 키워드: "[키워드1] vs [키워드2]", "[키워드1]으로 [키워드2] 하는 방법"

### FR-8.6: 수익 예측
**Priority:** P1 (High)

**Requirements:**
1. 예상 월간 트래픽 계산
2. 예상 클릭률(CTR) 적용
3. 예상 광고 수익 계산 (보수적/낙관적)

**Revenue Calculation:**
```
estimated_traffic = search_volume * rank_factor * click_through_rate
rank_factor = 0.3 (상위 3위 가정), 0.15 (4-10위), 0.05 (11-20위)
click_through_rate = 0.3 (보수적), 0.5 (낙관적)

ad_clicks = estimated_traffic * ad_ctr
ad_ctr = 0.01 (보수적), 0.03 (낙관적)

monthly_revenue = ad_clicks * cpc
```

### FR-8.7: 캐싱 시스템
**Priority:** P2 (Medium)

**Requirements:**
1. 키워드 데이터 캐시 (24시간)
2. 파일 기반 캐시 (`.cache/keywords/`)
3. 캐시 만료 시 자동 갱신

**Cache Structure:**
```json
{
  "keyword": "WordPress 플러그인",
  "timestamp": "2025-10-29T10:00:00Z",
  "ttl": 86400,
  "data": { ... }
}
```

### FR-8.8: 에러 핸들링
**Priority:** P1 (High)

**Requirements:**
1. Google API 인증 실패 시 명확한 에러 메시지
2. API 할당량 초과 시 캐시된 데이터 사용
3. 네트워크 에러 시 재시도 (최대 3회)
4. API 키 미설정 시 사용자 가이드 제공

**Error Messages:**
```
❌ Google Ads API 인증 실패
💡 다음 단계를 따라주세요:
1. Google Ads 계정 생성: https://ads.google.com
2. 개발자 토큰 발급: https://developers.google.com/google-ads/api/docs/get-started/dev-token
3. .env 파일에 다음 설정 추가:
   GOOGLE_ADS_DEVELOPER_TOKEN=...
   GOOGLE_ADS_CLIENT_ID=...
   GOOGLE_ADS_CLIENT_SECRET=...
```

---

## 5. Non-Goals (Out of Scope)

### Explicitly Excluded
1. **자동 포스트 생성**: 키워드와 주제만 추천, 포스트 작성은 사용자가 직접 수행
2. **유료 서비스 자동 구독**: API 키는 사용자가 직접 발급 및 설정
3. **개인정보 수집**: 검색 기록, 사용자 행동 데이터 저장 금지
4. **실시간 API 호출**: 캐싱을 통해 API 호출 최소화
5. **SEMrush/Ahrefs 통합**: Epic 8.0은 무료 Google Keyword Planner만 지원
6. **A/B 테스팅**: 키워드 효과 테스트 기능은 향후 Epic에서 구현
7. **경쟁사 분석**: 상위 랭크 사이트 분석은 제외
8. **자동 키워드 최적화**: SEO 개선 제안은 기존 analyze-seo 명령어 활용

### Future Considerations
- Epic 9.0: SEMrush/Ahrefs API 통합 (유료 옵션)
- Epic 10.0: 경쟁사 분석 및 벤치마킹
- Epic 11.0: A/B 테스팅 및 성과 추적

---

## 6. Design Considerations

### CLI UX
- 기존 trending 명령어 사용자 경험 유지
- `--revenue` 플래그로 점진적 기능 활성화
- 컬러 테이블로 가독성 향상
- 진행 상태 표시 (API 호출 중)

### 데이터 시각화
- CPC: 달러 표시 ($2.50)
- 검색량: 천 단위 구분 (12,000)
- 점수: 소수점 1자리 (78.5)
- 난이도: Low/Medium/High + 숫자 (45)

### 사용자 가이드
- 첫 실행 시 설정 가이드 표시
- Google Ads API 설정 문서 링크 제공
- 예제 명령어 제공

---

## 7. Technical Considerations

### Dependencies
```json
{
  "google-ads-api": "^21.0.0",
  "node-cache": "^5.1.2"
}
```

### Environment Variables
```env
# Google Ads API (필수)
GOOGLE_ADS_DEVELOPER_TOKEN=your-dev-token
GOOGLE_ADS_CLIENT_ID=your-client-id
GOOGLE_ADS_CLIENT_SECRET=your-client-secret
GOOGLE_ADS_REFRESH_TOKEN=your-refresh-token
GOOGLE_ADS_CUSTOMER_ID=your-customer-id

# 선택 사항
KEYWORD_CACHE_TTL=86400  # 24시간 (초)
```

### API 할당량
- Google Ads API: 일일 15,000 작업
- 키워드당 1 작업 → 15,000 키워드/일
- 캐싱으로 실제 사용량 최소화

### 성능 목표
- API 응답 시간: <3초 (10개 키워드)
- 캐시 히트율: >80%
- 메모리 사용량: <100MB

### 보안 고려사항
- API 키는 환경 변수로만 관리
- .env 파일 .gitignore 추가
- 민감 정보 로그 출력 금지

### 테스팅
- Google Ads API 모킹
- 캐시 로직 단위 테스트
- 점수 계산 알고리즘 테스트
- CLI 명령어 통합 테스트

---

## 8. Success Metrics

### Primary Metrics
1. **광고 수익 증가율**
   - 목표: trending --revenue 사용 후 월 광고 수익 15% 증가
   - 측정: Google AdSense 수익 대시보드
   - 기간: 3개월 평균

2. **키워드 추천 정확도**
   - 목표: 추천 키워드의 80% 이상이 실제 수익 증가에 기여
   - 측정: 추천 키워드로 작성한 포스트의 수익 vs 평균 수익
   - 기간: 월간

3. **사용 빈도**
   - 목표: 주 2회 이상 trending --revenue 사용
   - 측정: 명령어 실행 로그
   - 기간: 월간

### Secondary Metrics
1. **상위 노출 개수**
   - 목표: Google 1페이지 노출 포스트 20% 증가
   - 측정: Google Search Console
   - 기간: 분기

2. **트래픽 증가**
   - 목표: 월간 방문자 수 25% 증가
   - 측정: Google Analytics
   - 기간: 3개월 평균

3. **API 호출 최적화**
   - 목표: 캐시 히트율 80% 이상
   - 측정: 캐시 통계 로그
   - 기간: 월간

### Baseline 수집
- Epic 8.0 구현 전 4주간 데이터 수집
- 포스트당 평균 광고 수익
- 월간 총 광고 수익
- 상위 노출 키워드 개수

---

## 9. Open Questions

### Technical Questions
1. **Q: Google Keyword Planner API 무료 티어 제한은?**
   - A: TBD - Google Ads 계정 생성 후 확인 필요

2. **Q: 한국어 키워드 데이터 품질은?**
   - A: TBD - 테스트 후 결정. 품질이 낮으면 Naver 키워드 도구 고려

3. **Q: 캐시 만료 정책은?**
   - A: 제안 - 24시간. 사용자 피드백 후 조정

### Product Questions
1. **Q: trending 명령어 기본 동작은 revenue 포함?**
   - A: 제안 - 기본값은 기존 동작 유지. `--revenue` 명시 시만 활성화

2. **Q: 주제 추천 개수는?**
   - A: 제안 - 상위 5개 키워드당 1-2개 주제 = 총 5-10개

3. **Q: 수익 예측 정확도 개선 방법은?**
   - A: 제안 - 사용자 피드백 수집 후 알고리즘 튜닝

### Documentation Questions
1. **Q: Google Ads API 설정 가이드는?**
   - A: docs/GOOGLE_ADS_SETUP.md 작성 예정

2. **Q: PRODUCTION_GUIDE.md 업데이트?**
   - A: Yes - Step 1에 trending --revenue 추가

---

## 10. Implementation Plan

### Phase 1: Core Integration (2주)
- Task 8.1: Google Ads API 클라이언트 구현
- Task 8.2: 환경 변수 설정 및 인증
- Task 8.3: 키워드 데이터 조회 API 연동

### Phase 2: Algorithm & Logic (1주)
- Task 8.4: 수익성 점수 계산 알고리즘
- Task 8.5: 데이터 정규화 및 가중치 설정
- Task 8.6: 통합 점수 계산

### Phase 3: CLI Integration (1주)
- Task 8.7: trending 명령어 확장
- Task 8.8: 터미널 출력 포맷팅
- Task 8.9: JSON 출력 구현

### Phase 4: Advanced Features (1주)
- Task 8.10: 주제 추천 로직
- Task 8.11: 수익 예측 계산
- Task 8.12: 캐싱 시스템

### Phase 5: Testing & Documentation (1주)
- Task 8.13: 단위 테스트 작성
- Task 8.14: 통합 테스트
- Task 8.15: 문서화 (Google Ads 설정 가이드)
- Task 8.16: PRODUCTION_GUIDE.md 업데이트

**Total Estimate**: 6주

---

## 11. Appendix

### Reference Links
- [Google Ads API Documentation](https://developers.google.com/google-ads/api/docs/start)
- [Google Keyword Planner Guide](https://support.google.com/google-ads/answer/7337243)
- [google-ads-api NPM Package](https://www.npmjs.com/package/google-ads-api)

### Related Epics
- Epic 7.0: SEO Optimization System (analyze-seo 명령어)
- Epic 9.0: Advanced Keyword Research (SEMrush/Ahrefs 통합, 향후)
- Epic 10.0: Content Performance Tracking (수익 추적, 향후)

---

**작성일**: 2025-10-29
**작성자**: Claude Code
**버전**: 1.0
**상태**: Draft
